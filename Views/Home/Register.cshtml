@{
    ViewData["Title"] = "Register";
}

<h2 class="text-center mt-4">Criar Conta</h2>

<form id="registerForm" class="d-flex flex-column align-items-center">
    <div class="mb-3 w-50">
        <label for="exampleInputFullName" class="form-label">Nome completo</label>
        <input type="text" class="form-control" id="exampleInputFullName" name="FullName" required />
    </div>
    <div class="mb-3 w-50">
        <label for="exampleInputUsername" class="form-label">Nome de utilizador</label>
        <input type="text" class="form-control" id="exampleInputUsername" name="Username" required />
    </div>
    <div class="mb-3 w-50">
        <label for="exampleInputPassword1" class="form-label">Palavra-passe</label>
        <input type="password" class="form-control" id="exampleInputPassword1" name="Password" oninput="checkPasswordStrength()" required />
        <div class="progress mt-2 w-50">
            <div id="passwordStrengthBar" class="progress-bar" role="progressbar" title="Força da password"
                 style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div id="passwordStrengthMessage" class="form-text mt-2 p-2"></div>
    </div>
    <button type="submit" class="btn custom-login-btn btn-lg">Criar Conta</button>
</form>

@section Scripts {
    <script>
        function checkPasswordStrength() {
            const password = document.getElementById('exampleInputPassword1').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            const strengthMessage = document.getElementById('passwordStrengthMessage');
            let strength = 0;

            if (password.length >= 8) strength += 20;
            if (/[A-Z]/.test(password)) strength += 20;
            if (/[a-z]/.test(password)) strength += 20;
            if (/[0-9]/.test(password)) strength += 20;
            if (/[^A-Za-z0-9]/.test(password)) strength += 20;

            strengthBar.style.width = strength + '%';
            strengthBar.setAttribute('aria-valuenow', strength);

            if (strength < 40) {
                strengthBar.className = 'progress-bar bg-danger';
                strengthMessage.textContent = 'Password pouco segura';
            } else if (strength < 80) {
                strengthBar.className = 'progress-bar bg-warning';
                strengthMessage.textContent = 'Password minimamente segura';
            } else {
                strengthBar.className = 'progress-bar bg-success';
                strengthMessage.textContent = 'Password segura';
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("registerForm");
            if (!form) {
                console.error("Formulário com ID 'registerForm' não encontrado.");
                return;
            }

            form.addEventListener("submit", async function (e) {
                e.preventDefault();

                const formData = new FormData(form);
                const data = {
                    FullName: formData.get("FullName"),
                    Username: formData.get("Username"),
                    Password: formData.get("Password")
                };

                const response = await fetch("/api/account/register", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert("Conta criada com sucesso!");
                    window.location.href = "/Home/Login";
                } else {
                    const error = await response.text();
                    alert("Erro ao criar conta: " + error);
                    console.error("Erro ao criar conta:", error);
                }
            });
        });
    </script>
}
